<div class="readme-block">
  <div>
    <style>
      @import url(/_upload/tpl/0c/d8/3288/template3288/css/github.css);
    </style>
    <h1 id="contributingtoabacus">Contributing to ABACUS</h1>
    <p>
      First of all, thank you for taking time making contributions to ABACUS!
      This file provides a guideline for it.
    </p>
    <h2 id="tableofcontents">Table of Contents</h2>
    <ul>
      <li><a href="#got-a-question">Got a question?</a></li>
      <li><a href="#structure-of-the-package">Structure of the package</a></li>
      <li><a href="#submitting-an-issue">Submitting an Issue</a></li>
      <li>
        <a href="#comment-style-for-documentation"
          >Comment Style for documentation</a
        >
      </li>
      <li><a href="#code-formatting-style">Code formatting style</a></li>
      <li><a href="#adding-a-unit-test">Adding a unit test</a></li>
      <li>
        <a href="#submitting-a-pull-request">Submitting a Pull Request</a>
      </li>
      <li>
        <a href="#commit-message-guidelines">Commit Message Guidelines</a>
      </li>
    </ul>
    <h2 id="got-a-question">Got a question?</h2>
    <p>
      Please referring to our GitHub
      <a href="https://github.com/deepmodeling/abacus-develop/issues"
        >issue tracker</a
      >, and our developers are willing to help. If you find a bug, you can help
      us by submitting an issue to our GitHub Repository. Even better, you can
      submit a Pull Request with a patch. You can request a new feature by
      submitting an issue to our GitHub Repository. If you would like to
      implement a new feature, please submit an issue with a proposal for your
      work first, and that ensures your work collaborates with our development
      road map well. For a major feature, first open an issue and outline your
      proposal so that it can be discussed. This will also allow us to better
      coordinate our efforts, prevent duplication of work, and help you to craft
      the change so that it is successfully accepted into the project.
    </p>
    <h2 id="structure-of-the-package">Structure of the package</h2>
    <p>
      Please refer to <a href="./install.html">our instructions</a> on how to
      installing ABACUS. The source code of ABACUS is based on several modules.
      Under the ABACUS root directory, there are the following folders:
    </p>
    <ul>
      <li>
        <code>cmake</code>: relevant files for finding required packages when
        compiling the code with cmake;
      </li>
      <li><code>docs</code>: documents and supplementary info about ABACUS;</li>
      <li><code>examples</code>: some examples showing the usage of ABACUS;</li>
      <li>
        <code>source</code>: the source code in separated modules, under which a
        <code>test</code> folder for its unit tests;
      </li>
      <li><code>tests</code>: End-to-end test cases;</li>
      <li>
        <code>tools</code>: the script for generating the numerical atomic
        orbitals.
      </li>
    </ul>
    <h2 id="submitting-an-issue">Submitting an Issue</h2>
    <p>
      Before you submit an issue, please search the issue tracker, and maybe
      your problem has been discussed and fixed. You can
      <a href="https://github.com/deepmodeling/abacus-develop/issues/new/choose"
        >submit new issues</a
      >
      by filling our issue forms. To help us reproduce and confirm a bug, please
      provide a test case and building environment in your issue.
    </p>
    <h2 id="comment-style-for-documentation">
      Comment Style for documentation
    </h2>
    <p>
      ABACUS uses Doxygen to generate docs directly from <code>.h</code> and
      <code>.cpp</code> code files.
    </p>
    <p>
      For comments that need to be shown in documents, these formats should be
      used -- <strong>Javadoc style</strong> (as follow) is recommended, though
      Qt style is also ok. See it in
      <a href="https://www.doxygen.nl/manual/docblocks.html">official manual</a
      >.
    </p>
    <p>
      A helpful VS Code extension --
      <a
        href="https://marketplace.visualstudio.com/items?itemName=cschlosser.doxdocgen"
        >Doxygen Documentation Generator</a
      >, can help you formating comments.
    </p>
    <p>
      An practical example is class
      <a
        href="https://github.com/deepmodeling/abacus-develop/blob/deepks/source/module_deepks/LCAO_deepks.h"
        >LCAO_Deepks</a
      >, the effects can be seen on
      <a
        href="https://abacus-deepks.readthedocs.io/en/latest/DeePKS_API/classLCAO__Descriptor.html#exhale-class-classLCAO-Descriptor"
        >readthedocs page</a
      >
    </p>
    <ul>
      <li><p>Tips</p></li>
      <li>
        <p>
          Only comments in .h file will be visible in generated by Doxygen +
          Sphinx;
        </p>
      </li>
      <li><p>Private class members will not be documented;</p></li>
      <li>
        <p>
          Use
          <a href="https://www.doxygen.nl/manual/markdown.html"
            >Markdown features</a
          >, such as using a empty new line for a new paragraph.
        </p>
      </li>
      <li>
        <p>Detailed Comment Block</p>
        <pre><code class="cpp language-cpp">/**
* ... text ...
*/
</code></pre>
      </li>
      <li>
        <p>Brief + Detailed Comment Block</p>
        <pre><code class="cpp language-cpp">/// Brief description which ends at this dot. Details follow
/// here.

/// Brief description.
/** Detailed description. */
</code></pre>
      </li>
      <li>
        <p>Comments After the Item: Add a "&lt;"</p>
        <pre><code class="cpp language-cpp">int var; /**&lt;Detailed description after the member */
int var; ///&lt;Brief description after the member
</code></pre>
      </li>
      <li>
        <p>
          Parameters usage: <code>[in],[out],[in,out] description</code>
          <em>e.g.</em>
        </p>
        <pre><code class="cpp language-cpp">void foo(int v/**&lt; [in] docs for input parameter v.*/);
</code></pre>
        <p>or use <code>@param</code> command.</p>
      </li>
      <li><p>Formula</p></li>
      <li>
        <p>inline: <code>\f$myformula\f$</code></p>
      </li>
      <li>
        <p>separate line: <code>\f[myformula\f]</code></p>
      </li>
      <li>
        <p>environment: <code>\f{environment}{myformula}</code></p>
      </li>
      <li>
        <p><em>e.g.</em></p>
        <pre><code class="latex language-latex">\f{eqnarray*}{
  g &amp;=&amp; \frac{Gm_2}{r^2} \\
  &amp;=&amp; \frac{(6.673 \times 10^{-11}\,\mbox{m}^3\,\mbox{kg}^{-1}\,
      \mbox{s}^{-2})(5.9736 \times 10^{24}\,\mbox{kg})}{(6371.01\,\mbox{km})^2} \\
  &amp;=&amp; 9.82066032\,\mbox{m/s}^2
\f}
</code></pre>
      </li>
    </ul>
    <h2 id="code-formatting-style">Code formatting style</h2>
    <p>
      We use <code>clang-format</code> as our code formatter. The
      <code>.clang-format</code> file in root directory describes the rules to
      conform with. For Visual Studio Code developers, the
      <a
        href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools"
        >official extension of C/C++</a
      >
      provided by Microsoft can help you format your codes following the rules.
      With this extension installed, format your code with
      <code>shift+command/alt+f</code>. Configure your VS Code settings as
      <code>"C_Cpp.clang_format_style": "file"</code> (you can look up this
      option by pasting it into the search box of VS Code settings page), and
      all this stuff will take into effect. You may also set
      <code>"editor.formatOnSave": true</code> to avoid formatting files
      everytime manually.
    </p>
    <h2 id="adding-a-unit-test">Adding a unit test</h2>
    <p>
      We use GoogleTest as our test framework. Write your test under the
      corresponding module folder at <code>abacus-develop/tests</code>, then
      append the test to <code>tests/CMakeLists.txt</code>. If there are
      currently no unit tests provided for the module, do as follows.
      <code>module_base</code> provides a simple demonstration.
    </p>
    <ul>
      <li>Add a folder named <code>test</code> under the module.</li>
      <li>
        Append the content below to <code>CMakeLists.txt</code> of the module:
      </li>
    </ul>
    <pre><code class="cmake language-cmake">IF (BUILD_TESTING)
add_subdirectory(test)
endif()
</code></pre>
    <ul>
      <li>
        Add a blank <code>CMakeLists.txt</code> under <code>module*/test</code>.
      </li>
    </ul>
    <p>To add a unit test:</p>
    <ul>
      <li>Write your test under <code>GoogleTest</code> framework.</li>
      <li>
        Add your testing source code with suffix <code>*_test.cpp</code> in
        <code>test</code> directory.
      </li>
      <li>
        Append the content below to <code>CMakeLists.txt</code> of the module:
      </li>
    </ul>
    <pre><code class="cmake language-cmake">AddTest(
TARGET &lt;module_name&gt;_&lt;test_name&gt; # this is the executable file name of the test
SOURCES &lt;test_name&gt;.cpp

# OPTIONAL: if this test requires external libraries, add them with "LIBS" statement.
LIBS math_libs # `math_libs` includes all math libraries in ABACUS.
)
</code></pre>
    <ul>
      <li>
        Build with <code>-D BUILD_TESTING=1</code> flag. You can find built
        testing programs under
        <code>build/source/&lt;module_name&gt;/test</code>.
      </li>
      <li>
        Follow the installing procedure of CMake. The tests will move to
        <code>build/test</code>.
      </li>
    </ul>
    <h2 id="submitting-a-pull-request">Submitting a Pull Request</h2>
    <ol>
      <li>
        <p>
          <a
            href="https://docs.github.com/en/github/getting-started-with-github/fork-a-repo"
            >Fork</a
          >
          the ABACUS repo.
        </p>
      </li>
      <li>
        <p>
          Pull your forked repository, and create a new git branchmake to your
          changes in it:
        </p>
        <pre><code class="shell language-shell"> git checkout -b my-fix-branch
</code></pre>
      </li>
      <li>
        <p>
          Coding your patch, including appropriate test cases and docs. To run a
          subset of unit test, use
          <code>ctest -R &lt;test-match-pattern&gt;</code> to perform tests with
          name matched by given pattern.
        </p>
      </li>
      <li>
        <p>
          After tests passed, commit your changes
          <a href="#commit-message-guidelines">with a proper message</a>.
        </p>
      </li>
      <li>
        <p>Push your branch to GitHub:</p>
        <pre><code class="shell language-shell">git push origin my-fix-branch
</code></pre>
      </li>
      <li>
        <p>
          In GitHub, send a pull request with
          <code>deepmodeling/abacus-develop:develop</code> as the base
          repository.
        </p>
      </li>
      <li>
        <p>
          After your pull request is merged, you can safely delete your branch
          and sync the changes from the main (upstream) repository:
        </p>
      </li>
    </ol>
    <ul>
      <li>
        <p>
          Delete the remote branch on GitHub either through the GitHub web UI or
          your local shell as follows:
        </p>
        <pre><code class="shell language-shell">git push origin --delete my-fix-branch
</code></pre>
      </li>
      <li>
        <p>Check out the master branch:</p>
        <pre><code class="shell language-shell">git checkout develop -f
</code></pre>
      </li>
      <li>
        <p>Delete the local branch:</p>
        <pre><code class="shell language-shell">git branch -D my-fix-branch
</code></pre>
      </li>
      <li>
        <p>Update your master with the latest upstream version:</p>
        <pre><code class="shell language-shell">git pull --ff upstream develop
</code></pre>
      </li>
    </ul>
    <h2 id="commit-message-guidelines">Commit Message Guidelines</h2>
    <p>
      A well-formatted commit message leads a more readable history when we look
      through some changes, and helps us generate change log. We follow up
      <a href="www.conventionalcommits.org"
        >The Conventional Commits specification</a
      >
      for commit message format. The commit message should be structured as
      follows:
    </p>
    <pre><code class="text language-text">&lt;type&gt;[optional scope]: &lt;description&gt;

[optional body]

[optional footer(s)]
</code></pre>
    <ul>
      <li>Header</li>
      <li>
        type: The general intention of this commit
        <ul>
          <li><code>feat</code>: A new feature</li>
          <li><code>fix</code>: A bug fix</li>
          <li><code>docs</code>: Only documentation changes</li>
          <li>
            <code>style</code>: Changes that do not affect the meaning of the
            code
          </li>
          <li>
            <code>refactor</code>: A code change that neither fixes a bug nor
            adds a feature
          </li>
          <li><code>perf</code>: A code change that improves performance</li>
          <li>
            <code>test</code>: Adding missing tests or correcting existing tests
          </li>
          <li>
            <code>build</code>: Changes that affect the build system or external
            dependencies
          </li>
          <li>
            <code>ci</code>: Changes to our CI configuration files and scripts
          </li>
          <li><code>revert</code>: Reverting commits</li>
        </ul>
      </li>
      <li>
        scope: The scope could be the module which this commit changes; for
        example, <code>orbital</code>
      </li>
      <li>
        description: A short summary of the code changes: tell others what you
        did in one sentence.
      </li>
      <li>
        Body: optional, providing additional contextual information about the
        code changes, e.g. the motivation of this commit, referenced materials,
        and so on.
      </li>
      <li>
        Footer: optional, reference GitHub issues, PRs that this commit closes
        or is related to
      </li>
    </ul>
    <p>Here is an example:</p>
    <pre><code class="text language-text">fix(lcao): use correct scalapack interface.

`pzgemv_` and `pzgemm_` used `double*` for alpha and beta parameters but not `complex*` , this would cause error in GNU compiler.

Fix #753.
</code></pre>
  </div>
</div>
